# 애그리거트

## 애그리거트 개념

백 개 이상의 테이블을 한 장의 ERD 에 모두 표시하려면 개별 관계를 파악하느라, 큰 틀에서 데이터 구조를 이해하는 데 어려움을 겪게 된다.
이와 비슷하게 도메인 객체 모델이 복잡해지면 개별 구성요소 위주로 모델을 이해하게 되고, 전반적인 구조나 큰 수준에서 도메인 간의 관계를 파악하기 어려워진다.

이렇게 복잡한 도메인을 이해하고 관리하기 쉬운 `단위`로 만들려면 상위 수준에서 모델을 조망할 수 있는 방법이 필요한데, 그 방법이 애그리거트이다. 
> 즉, 애그리거트는 관련된 객체를 하나로 묶은 군집이다.

애그리거트 단위로 도메인들을 나누고, 그 단위로 일관성을 관리하면 그 만큼 복잡도가 낮아지게되고 도메인을 확장하고 변경하는데 소요되는 비용도 줄어든다.

애그리거트의 경계를 설정할 떄 기본이 되는 것은 도메인의 규칙과 요구사항이다. 

- 도메인 규칙에 따라 `함께 생성되는` 구성요소는 한 애그리거트에 속할 가능성이 높다.
- 사용자 요구사항에 따라 `함께 변경되는` 빈도가 높은 객체들은 한 애그리거트에 속할 가능성이 높다.

주의할 점은 `A 가 B 를 갖는다` 의 관계를 보고 한 애그리거트로 묶어서 생각하기 쉬운데, 이 관계가 반드시 한 애그리거트에 속하는 것은 아니다.
예를 들어 상품과 리뷰는 상품이 리뷰를 갖는 관계이지만, 둘은 함께 생성되지도 않고 또 함께 변경되지도 않는다. 게다가 둘의 주체도 각각 상품 담당자와 소비자로 다르다. 
따라서 상품과 리뷰는 서로 다른 애그리거트로 볼 수 있다.

처음 도메인 모델을 만들 때, 많은 도메인들을 하나의 애그리거트로 보이는 경우가 많은데 이는 경험이 부족한 것으로 도메인 규칙과 요구사항을 더 깊이 파악하고 이해할수록 실제 애그리거트의 크기는 줄어든다.
> 보통 다수의 애그리거트가 한 개의 엔티티 객체만 갖는 경우가 많으며 두 개 이상의 엔티티로 구성되는 애그리거트는 흔치 않다.

## 애그리거트 루트

